# PuntoPunto

Минималистичный аналог Punto Switcher для macOS с автоматической конвертацией текста между английской и русской раскладками.

## Описание

Приложение для автоматического исправления слов и выделенного текста, набранных "не той" раскладкой. Поддерживает как ручной вызов по горячей клавише, так и автоматическую подмену слов по пробелу или знакам пунктуации.

## Основные возможности

- **Автоматическая подмена слов**: Конвертация текста при вводе пробела или знаков пунктуации
- **Горячая клавиша**: Ручная конвертация выделенного текста или последнего введенного слова (Option key)
- **Конвертация буфера обмена**: Преобразование текста в буфере между раскладками
- **Специальные символы**: Поддержка bidirectional конверсии спецсимволов (@↔", #↔№, $↔%, и др.)
- **Автоматическое переключение раскладки**: Система автоматически переключает раскладку после конверсии
- **Умная контекстная валидация**: Работает только в текстовых полях и редакторах
- **Звуковые уведомления**: Аудио-сигналы при успешных операциях

## Установка и запуск

### Сборка из исходников
```bash
# Клонирование репозитория
git clone <repository-url>
cd New\ Punto-Punto

# Сборка проекта
swift build -c release

# Копирование в Applications (опционально)
cp .build/release/PuntoPunto /Applications/
```

### Первый запуск
1. Запустите приложение
2. Предоставьте необходимые разрешения в Системных настройках:
   - **Accessibility**: Настройки → Конфиденциальность → Универсальный доступ
   - **Input Monitoring**: Настройки → Конфиденциальность → Мониторинг вводимых данных

## Использование

### Горячие клавиши
- **Option (⌥)**: Конвертировать выделенный текст или последнее слово
- **Option + другие модификаторы**: Проходят без изменений (сохраняется совместимость)

### Поддерживаемые конверсии
#### Буквы
- Английские → Русские: `q→й`, `w→ц`, `e→у`, `hello→руддщ`
- Русские → Английские: `й→q`, `ц→w`, `у→e`, `привет→ghbdtn`

#### Специальные символы
- EN → RU: `@→"`, `#→№`, `$→%`, `^→,`, `&→.`, `*→;`
- RU → EN: `"→@`, `№→#`, `%→$`, `,→^`, `.→&`, `;→*`

#### Пунктуация
- EN → RU: `[→х`, `]→ъ`, `;→ж`, `'→э`, `,→б`, `.→ю`
- RU → EN: `х→[`, `ъ→]`, `ж→;`, `э→'`, `б→,`, `ю→.`

### Контекстная работа
Приложение автоматически определяет контекст и работает только в:
- Текстовых редакторах (TextEdit, Xcode, VSCode)
- Браузерах (Safari, Chrome, Firefox)
- Canvas приложениях (Figma, Sketch)
- Desktop приложениях с текстовыми полями

## Архитектура

### Основные компоненты
```
Sources/
├── HotkeyManager.swift          # Управление горячими клавишами и CGEventTap
├── LayoutConverter.swift        # Конверсия текста между раскладками
├── ApplicationDetector.swift    # Определение типа активного приложения
├── ContextValidator.swift       # Валидация контекста для конверсии
├── ClipboardProcessor.swift     # Работа с буфером обмена
├── InputSourceManager.swift     # Управление системными раскладками
├── UniversalCanvaDetector.swift # Определение Canvas приложений
└── PasteboardManager.swift      # Backup/restore буфера обмена
```

### Принципы архитектуры
- **Single Responsibility Principle**: Каждый компонент отвечает за одну область
- **Minimalism**: Использование существующих системных API без внешних зависимостей
- **Event-driven**: Основан на CGEventTap и Accessibility API
- **Non-destructive**: Backup и restore буфера обмена при операциях

## Стек технологий и требования

### Системные требования
- **macOS**: 13.0+
- **Архитектура**: Apple Silicon (M1/M2/M3) или Intel
- **Swift**: 5.9+

### Используемые API
- **CGEventTap**: Перехват клавиатурных событий
- **Accessibility API**: Определение фокуса и выделенного текста
- **TIS (Text Input Source)**: Управление системными раскладками
- **NSPasteboard**: Работа с буфером обмена
- **SwiftUI**: Пользовательский интерфейс

### Зависимости
Проект использует только системные фреймворки macOS, без внешних зависимостей.

## Разработка

### Структура проекта
```
├── Sources/              # Основной код приложения
├── ai-helpers/           # Документация и логи разработки
│   └── logs/
│       └── issues-log.md # Журнал решенных проблем
├── Package.swift         # Swift Package Manager манифест
└── README.md            # Данный файл
```

### Сборка для разработки
```bash
# Debug сборка
swift build

# Запуск тестов (если есть)
swift test

# Запуск из командной строки
swift run PuntoPunto
```
